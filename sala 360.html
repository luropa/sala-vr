<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Sala com Teclado e Pegadas</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <script>
    AFRAME.registerComponent('gaze-teleport-jogo', {
      init: function () {
        this.el.addEventListener('mouseenter', () => {
          this.startTime = Date.now();
          this.checkGaze = setInterval(() => {
            const now = Date.now();
            if (now - this.startTime >= 2000) {
              clearInterval(this.checkGaze);
              const cameraRig = document.querySelector('#cameraRig');
              cameraRig.setAttribute('animation__moveToJogo', {
                property: 'position',
                to: '2.8 0.5 3.5',
                dur: 2000,
                easing: 'easeInOutQuad'
              });
            }
          }, 100);
        });
        this.el.addEventListener('mouseleave', () => {
          clearInterval(this.checkGaze);
        });
      }
    });

    AFRAME.registerComponent('interacao-lousa', {
      init: function () {
        const teclado = document.querySelector('#teclado');
        const texto = document.querySelector('#texto-digitado');
        const imagem = document.querySelector('#imagem-ninho');

        this.el.addEventListener('mouseenter', () => {
          this.timeout = setTimeout(() => {
            texto.setAttribute('visible', true);
            imagem.setAttribute('visible', true);
            teclado.setAttribute('visible', true);
            if (teclado.children.length === 0) criarTeclado();
          }, 2000);
        });

        this.el.addEventListener('mouseleave', () => {
          clearTimeout(this.timeout);
        });
      }
    });

    function criarTeclado() {
      const teclado = document.querySelector('#teclado');
      const textoDigitado = document.querySelector('#texto-digitado');
      const letras = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('');
      const espacamentoX = 0.3;
      const espacamentoY = 0.3;
      const startX = -6 * espacamentoX;
      const startY = 1.9;

      letras.forEach((letra, index) => {
        const linha = index < 13 ? 0 : 1;
        const col = index % 13;
        const x = startX + col * espacamentoX;
        const y = startY - linha * espacamentoY;

        const plano = document.createElement('a-plane');
        plano.setAttribute('width', 0.35);
        plano.setAttribute('height', 0.35);
        plano.setAttribute('color', "#fff");
        plano.setAttribute('opacity', 0.3);
        plano.setAttribute('position', `${x} ${y} -4.9`);
        plano.setAttribute('material', 'shader: flat; transparent: true;');

        const letraText = document.createElement('a-text');
        letraText.setAttribute('value', letra);
        letraText.setAttribute('align', 'center');
        letraText.setAttribute('color', '#000'); // Preto
        letraText.setAttribute('width', '2');
        letraText.setAttribute('position', '0 0 0.01');
        letraText.setAttribute('font', 'mozillavr');

        plano.appendChild(letraText);

        plano.addEventListener('click', () => {
          let textoAtual = textoDigitado.getAttribute('value');
          if (textoAtual.length < 10) {
            textoDigitado.setAttribute('value', textoAtual + letra);
          }
        });

        teclado.appendChild(plano);
      });

      // Botão Apagar
      const apagar = document.createElement('a-plane');
      apagar.setAttribute('width', 1);
      apagar.setAttribute('height', 0.4);
      apagar.setAttribute('color', '#fff');
      apagar.setAttribute('opacity', 0.3);
      apagar.setAttribute('position', `-1.5 1.2 -4.9`);
      apagar.setAttribute('material', 'shader: flat; transparent: true;');

      const textoApagar = document.createElement('a-text');
      textoApagar.setAttribute('value', 'Apagar');
      textoApagar.setAttribute('align', 'center');
      textoApagar.setAttribute('color', '#000'); // Preto
      textoApagar.setAttribute('width', '2');
      textoApagar.setAttribute('position', '0 0 0.01');
      textoApagar.setAttribute('font', 'mozillavr');

      apagar.appendChild(textoApagar);
      apagar.addEventListener('click', () => {
        let textoAtual = textoDigitado.getAttribute('value');
        textoDigitado.setAttribute('value', textoAtual.slice(0, -1));
      });

      teclado.appendChild(apagar);

      // Botão Entrar
      const entrar = document.createElement('a-plane');
      entrar.setAttribute('width', 1);
      entrar.setAttribute('height', 0.4);
      entrar.setAttribute('color', '#fff');
      entrar.setAttribute('opacity', 0.3);
      entrar.setAttribute('position', `1.5 1.2 -4.9`);
      entrar.setAttribute('material', 'shader: flat; transparent: true;');

      const textoEntrar = document.createElement('a-text');
      textoEntrar.setAttribute('value', 'Entrar');
      textoEntrar.setAttribute('align', 'center');
      textoEntrar.setAttribute('color', '#000'); // Preto
      textoEntrar.setAttribute('width', '2');
      textoEntrar.setAttribute('position', '0 0 0.01');
      textoEntrar.setAttribute('font', 'mozillavr');

      entrar.appendChild(textoEntrar);
      entrar.addEventListener('click', () => {
        const texto = textoDigitado.getAttribute('value').toUpperCase();
        const imagem = document.querySelector('#imagem-ninho');
        const estrela = document.querySelector('#estrela');
        const estrelaTriste = document.querySelector('#estrela-triste');
        const teclado = document.querySelector('#teclado');

        imagem.setAttribute('visible', false);
        teclado.setAttribute('visible', false);

        if (texto === "NINHO") {
          estrela.setAttribute('visible', true);
          setTimeout(() => estrela.setAttribute('visible', false), 3000);
        } else {
          estrelaTriste.setAttribute('visible', true);
          setTimeout(() => {
            estrelaTriste.setAttribute('visible', false);
            imagem.setAttribute('visible', true);
            teclado.setAttribute('visible', true);
          }, 3000);
        }
        textoDigitado.setAttribute('value', '');
      });

      teclado.appendChild(entrar);
    }
  </script>
</head>

<body>
  <a-scene>
    <a-assets>
      <img id="img-ninho" src="palavraninho.png" />
      <img id="img-estrela" src="estrelacontente.png" />
      <img id="img-estrela-triste" src="estrelatriste.png" />
      <img id="jogo" src="jogo-da-velha-feltro2.png" />
    </a-assets>

    <!-- ILUMINAÇÃO E FUNDO -->
    <a-light type="ambient" color="#ffffff" intensity="1.2"></a-light>
    <a-plane src="piso1.png" width="10" height="10" rotation="-90 0 0" class="piso" material="shader: flat;"></a-plane>
    <a-plane color="#a9c9dd" width="10" height="10" position="0 5 0" rotation="90 0 0"></a-plane>

    <!-- PAREDES -->
    <a-plane width="10" height="5" position="0 2.5 -5" material="color: #ccc"></a-plane>
    <a-plane width="10" height="5" position="0 2.5 5" rotation="0 180 0" material="color: #ccc"></a-plane>
    <a-plane width="10" height="5" position="-5 2.5 0" rotation="0 90 0" material="color: #ccc"></a-plane>
    <a-plane width="10" height="5" position="5 2.5 0" rotation="0 -90 0" material="color: #ccc"></a-plane>

    <!-- LOUSA -->
    <a-image
      id="lousa"
      src="lousaembranco2.png"
      position="0 2.5 -4.95"
      width="5.6"
      height="3.1"
      interacao-lousa
    ></a-image>

    <!-- ELEMENTOS DA LOUSA -->
    <a-image id="imagem-ninho" src="#img-ninho" position="0 3 -4.9" width="1" height="0.5" visible="false"></a-image>
    <a-text id="texto-digitado" value="" position="0 2.5 -4.9" color="#000" align="center" width="3" font="mozillavr" visible="false"></a-text>
    <a-image id="estrela" src="#img-estrela" position="0 4 -4.9" width="1" height="1" visible="false"></a-image>
    <a-image id="estrela-triste" src="#img-estrela-triste" position="0 4 -4.9" width="1" height="1" visible="false"></a-image>

    <!-- TECLADO -->
    <a-entity id="teclado" visible="false"></a-entity>

    <!-- BARREIRA INVISÍVEL -->
    <a-entity geometry="primitive: box; width: 8; height: 3; depth: 0.1"
              position="0 1.5 -4"
              material="opacity: 0; transparent: true"
              static-body></a-entity>

    <!-- PEGADAS -->
    <a-image src="pegadas.png" width="0.8" height="0.8" rotation="-90 180 0" position="2.7 0.01 4" gaze-teleport-jogo></a-image>

    <!-- CÂMERA E CURSOR -->
    <a-entity id="cameraRig" position="0 0.5 0">
      <a-camera look-controls>
        <a-cursor fuse="true" fuse-timeout="2000" color="red"
          geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
          material="color: red; shader: flat"
          position="0 0 -1"
          render-order="999"
        ></a-cursor>
      </a-camera>
    </a-entity>
  </a-scene>
</body>
</html>
