<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <title>Sala de Estudo com Teclado Virtual</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
    <script>
      let userMoved = false;
      let camera;
      let originalPosition;
      let enteredText = '';
      let textEntity;
      let keyboard;
      let inputAllowed = true;

      AFRAME.registerComponent('init-scene', {
        init: function () {
          camera = document.querySelector('[camera]');
          originalPosition = camera.getAttribute('position');
          textEntity = document.querySelector('#textInput');
          keyboard = document.querySelector('#keyboard');
          keyboard.setAttribute('visible', false);
        }
      });

      AFRAME.registerComponent('activate-on-gaze', {
        init: function () {
          this.el.addEventListener('click', () => {
            if (!userMoved) {
              moveToLousa();
            }
          });
        }
      });

      function moveToLousa() {
        const cameraRig = document.querySelector('#cameraRig');
        cameraRig.setAttribute('animation__move', {
          property: 'position',
          to: '0 1.6 -4.5',
          dur: 2000,
          easing: 'easeInOutQuad'
        });

        setTimeout(() => {
          showKeyboard();
        }, 2100);

        userMoved = true;
      }

      function showKeyboard() {
        document.querySelector('#textInput').setAttribute('visible', true);
        document.querySelector('#keyboard').setAttribute('visible', true);
        inputAllowed = true;
      }

      function hideKeyboard() {
        document.querySelector('#textInput').setAttribute('visible', false);
        document.querySelector('#keyboard').setAttribute('visible', false);
        inputAllowed = false;
      }

      function addLetter(letter) {
        if (!inputAllowed) return;
        enteredText += letter;
        updateText();
      }

      function eraseLetter() {
        if (!inputAllowed) return;
        enteredText = enteredText.slice(0, -1);
        updateText();
      }

      function updateText() {
        textEntity.setAttribute('value', enteredText);
      }

      function submitWord() {
        if (!inputAllowed) return;

        hideKeyboard();

        if (enteredText.toLowerCase() === 'ninho') {
          showStar('happy');
          setTimeout(() => {
            document.querySelector('#happyStar').setAttribute('visible', false);
            enteredText = '';
            updateText();
          }, 2000);
        } else {
          showStar('sad');
          setTimeout(() => {
            document.querySelector('#sadStar').setAttribute('visible', false);
            enteredText = '';
            updateText();
            showKeyboard();
          }, 2000);
        }
      }

      function showStar(type) {
        const star = document.querySelector(`#${type}Star`);
        star.setAttribute('visible', true);
      }
    </script>
  </head>
  <body>
    <a-scene init-scene>
      <!-- Câmera com cursor -->
      <a-entity id="cameraRig" position="0 1.6 0">
        <a-entity camera look-controls>
          <a-entity
            cursor="fuse: true; fuseTimeout: 2000"
            position="0 0 -1"
            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
            material="color: red; shader: flat"
          ></a-entity>
        </a-entity>
      </a-entity>

      <!-- Lousa -->
      <a-plane position="0 2 -6" rotation="-10 0 0" width="4" height="2.5" color="#333" activate-on-gaze></a-plane>

      <!-- Texto digitado -->
      <a-entity
        id="textInput"
        position="0 2.8 -6"
        text="value: ; color: white; align: center; width: 4"
        visible="false"
      ></a-entity>

      <!-- Teclado -->
      <a-entity id="keyboard" visible="false">
        <a-plane position="0 1.5 -6" width="3" height="1.5" color="#111"></a-plane>

        <!-- Letras -->
        <a-entity id="letters">
          <a-plane position="-1 2 -6" width="0.4" height="0.4" color="#FFD700" text="value: N; align: center" 
                   event-set__click="_event: click; _target: #keyboard; _delay: 0; _call: addLetter('N')"></a-plane>

          <a-plane position="-0.5 2 -6" width="0.4" height="0.4" color="#FFD700" text="value: I; align: center"
                   onclick="addLetter('I')"></a-plane>

          <a-plane position="0 2 -6" width="0.4" height="0.4" color="#FFD700" text="value: H; align: center"
                   onclick="addLetter('H')"></a-plane>

          <a-plane position="0.5 2 -6" width="0.4" height="0.4" color="#FFD700" text="value: O; align: center"
                   onclick="addLetter('O')"></a-plane>
        </a-entity>

        <!-- Botão Apagar -->
        <a-plane position="-0.75 1.5 -6" width="0.6" height="0.3" color="#FF6347" text="value: Apagar; align: center"
                 onclick="eraseLetter()"></a-plane>

        <!-- Botão Entrar -->
        <a-plane position="0.75 1.5 -6" width="0.6" height="0.3" color="#32CD32" text="value: Entrar; align: center"
                 onclick="submitWord()"></a-plane>
      </a-entity>

      <!-- Estrela feliz -->
      <a-image id="happyStar" src="#happy" position="0 2.5 -6" width="1" height="1" visible="false"></a-image>

      <!-- Estrela triste -->
      <a-image id="sadStar" src="#sad" position="0 2.5 -6" width="1" height="1" visible="false"></a-image>

      <!-- Assets das estrelas -->
      <a-assets>
        <img id="happy" src="estrela_contente.png">
        <img id="sad" src="estrela_triste.png">
      </a-assets>
    </a-scene>
  </body>
</html>
