<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Sala de Estudo com Teclado Virtual e Movimento por Gaze</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background: #fcefdc; }
  </style>
</head>
<body>
  <a-scene>

    <!-- Assets -->
    <a-assets>
      <a-asset-item id="modeloCadeira" src="cadeira_final.glb"></a-asset-item>
      <img id="img-ninho" src="palavraninho.png" />
      <img id="img-estrela" src="estrelacontente.png" />
      <img id="img-estrela-triste" src="estrelatriste.png" />
    </a-assets>

    <!-- Luz ambiente -->
    <a-light type="ambient" color="#ffffff" intensity="1.2"></a-light>

    <!-- Piso e teto -->
    <a-plane src="piso1.png" width="10" height="10" rotation="-90 0 0"></a-plane>
    <a-plane color="#a9c9dd" width="10" height="10" position="0 5 0" rotation="90 0 0"></a-plane>

    <!-- Lousa -->
    <a-image id="lousa" src="lousaembranco2.png" width="5.6" height="3.1" position="0 2.5 -4.95" interacao-lousa gaze-activate-move></a-image>

    <!-- Palavra/estrela -->
    <a-image id="imagem-ninho" src="#img-ninho" width="1" height="0.5" position="0 3 -4.9" visible="false"></a-image>

    <!-- Texto digitado -->
    <a-text id="texto-digitado" value="" position="0 2.5 -4.9" color="#000" align="center" width="3" visible="false"></a-text>

    <!-- Teclado -->
    <a-entity id="teclado" visible="false"></a-entity>

    <!-- CÃ¢mera com gaze e movimento -->
    <a-entity id="cameraRig" position="0 1.6 0" gaze-move-controller>
      <a-camera look-controls>
        <a-cursor fuse="true" fuse-timeout="2000"
                  geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
                  material="color: red; shader: flat" position="0 0 -1"></a-cursor>
      </a-camera>
    </a-entity>

    <!-- Objetos da sala -->
    <a-image src="tapete.png" width="5" height="7" rotation="-90 0 0" position="-3 0.01 1"></a-image>
    <a-image src="ponteirotwister.png" width="0.9" height="0.9" rotation="-90 0 0" position="-1.2 0.02 2"></a-image>
    <a-image src="tatame.png" width="4" height="4" rotation="-90 0 0" position="2.7 0.01 1"></a-image>
    <a-image src="quebra-cabeca.png" width="1.4" height="1.8" rotation="-90 10 0" position="1.55 0.02 2"></a-image>
    <a-image src="janela2.png" width="5.5" height="5.5" position="-4.95 2.5 0" rotation="0 90 0"></a-image>
    <a-image src="jogo-da-velha-feltro2.png" width="1.5" height="1.5" position="3 1.5 4.94" rotation="0 180 0"></a-image>
    <a-image src="interruptor-branco.png" width="0.3" height="0.3" position="-1.5 2 4.94" rotation="0 180 0"></a-image>
    <a-image src="relogio2.png" width="0.8" height="0.8" position="3.5 2.5 -4.95"></a-image>
    <a-image src="nuvem2.png" width="2" height="1.7" position="3.5 3.5 -4.95"></a-image>
    <a-image src="nuvem2.png" width="2" height="1.7" position="-3.5 3.5 -4.95"></a-image>

    <!-- Cadeira -->
    <a-entity id="cadeira" gltf-model="#modeloCadeira" position="3 0 -3" scale="0.8 0.8 0.8"></a-entity>

  </a-scene>

  <script>
    AFRAME.registerComponent('gaze-move-controller', {
      schema: { speed: { type: 'number', default: 1.5 } },
      init: function () {
        this.direction = new THREE.Vector3();
        this.moving = false;
        this.cameraEl = this.el.querySelector('a-camera');
      },
      tick: function (time, deltaTime) {
        if (!this.moving) return;
        const d = this.data.speed * (deltaTime / 1000);
        this.cameraEl.object3D.getWorldDirection(this.direction);
        this.direction.y = 0;
        this.direction.normalize();
        if (this.el.object3D.position.z <= -4.45) {
          this.moving = false;
          return;
        }
        this.el.object3D.position.add(this.direction.multiplyScalar(-d));
      }
    });

    AFRAME.registerComponent('gaze-activate-move', {
      init: function () {
        const rig = document.querySelector('#cameraRig');
        const imagem = document.querySelector('#imagem-ninho');
        const teclado = document.querySelector('#teclado');
        const textoDigitado = document.querySelector('#texto-digitado');
        const tamanhoOriginal = { width: 1, height: 0.5 };

        this.el.addEventListener('mouseenter', () => {
          this.timeout = setTimeout(() => {
            imagem.setAttribute('visible', true);
            imagem.setAttribute('src', '#img-ninho');
            imagem.setAttribute('width', tamanhoOriginal.width.toString());
            imagem.setAttribute('height', tamanhoOriginal.height.toString());
            imagem.setAttribute('position', '0 3 -4.9');

            textoDigitado.setAttribute('visible', true);
            textoDigitado.setAttribute('value', '');
            teclado.setAttribute('visible', true);

            if (rig.object3
