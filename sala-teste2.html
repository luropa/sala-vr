<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <title>Sala de Estudo com Teclado Virtual e Movimento por Gaze</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script>
      AFRAME.registerComponent('gaze-move-once', {
        schema: {
          target: { type: 'selector' },
          triggered: { default: false }
        },
        init: function () {
          this.el.addEventListener('mouseenter', () => {
            if (this.data.triggered) return;
            this.timeout = setTimeout(() => {
              this.data.triggered = true;
              const camera = document.querySelector('[camera]');
              const targetPos = this.data.target.object3D.position.clone();
              const direction = new THREE.Vector3().subVectors(targetPos, camera.object3D.position).normalize();
              const distance = 4.5; // distância final
              const newPos = new THREE.Vector3().addVectors(targetPos, direction.multiplyScalar(-distance));
              camera.setAttribute('position', newPos);
              document.querySelector('#ninhoTexto').setAttribute('visible', true);
              document.querySelector('#teclado').setAttribute('visible', true);
              document.querySelector('#inputText').setAttribute('visible', true);
            }, 2000);
          });
          this.el.addEventListener('mouseleave', () => {
            clearTimeout(this.timeout);
          });
        }
      });

      AFRAME.registerComponent('teclado', {
        init: function () {
          const inputText = document.querySelector('#inputText');
          let currentText = '';
          const teclado = this.el;
          const estrelas = {
            contente: document.querySelector('#estrelaContente'),
            triste: document.querySelector('#estrelaTriste')
          };
          const textoNinho = document.querySelector('#ninhoTexto');

          teclado.querySelectorAll('[letra]').forEach(tecla => {
            tecla.addEventListener('click', () => {
              const letra = tecla.getAttribute('letra');
              currentText += letra;
              inputText.setAttribute('value', currentText);
            });
          });

          const btnApagar = document.querySelector('#apagar');
          btnApagar.addEventListener('click', () => {
            currentText = currentText.slice(0, -1);
            inputText.setAttribute('value', currentText);
          });

          const btnEntrar = document.querySelector('#entrar');
          btnEntrar.addEventListener('click', () => {
            inputText.setAttribute('value', currentText);
            teclado.setAttribute('visible', false);
            inputText.setAttribute('visible', false);
            textoNinho.setAttribute('visible', false);

            if (currentText.toLowerCase() === 'ninho') {
              estrelas.contente.setAttribute('visible', true);
              setTimeout(() => {
                estrelas.contente.setAttribute('visible', false);
                currentText = '';
                inputText.setAttribute('value', '');
              }, 2000);
            } else {
              estrelas.triste.setAttribute('visible', true);
              setTimeout(() => {
                estrelas.triste.setAttribute('visible', false);
                currentText = '';
                inputText.setAttribute('value', '');
                teclado.setAttribute('visible', true);
                inputText.setAttribute('visible', true);
                textoNinho.setAttribute('visible', true);
              }, 2000);
            }
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <!-- Câmera -->
      <a-entity camera look-controls position="0 1.6 10"></a-entity>

      <!-- Lousa -->
      <a-plane id="lousa" color="#222" width="4" height="2" position="0 2 -3" gaze-move-once="target: #lousa"></a-plane>

      <!-- Palavra no topo -->
      <a-text id="ninhoTexto" value="ninho" visible="false" color="#fff" position="0 3.3 -3" align="center"></a-text>

      <!-- Campo de texto -->
      <a-text id="inputText" value="" visible="false" color="yellow" position="0 2.5 -3" align="center"></a-text>

      <!-- Estrela contente -->
      <a-image id="estrelaContente" visible="false" src="#estrelaContenteImg" position="0 2.5 -2.9" width="1" height="1"></a-image>
      <a-image id="estrelaTriste" visible="false" src="#estrelaTristeImg" position="0 2.5 -2.9" width="1" height="1"></a-image>

      <!-- Teclado -->
      <a-entity id="teclado" teclado visible="false">
        <a-plane letra="N" position="-0.6 1.5 -3" width="0.3" height="0.3" color="#ccc"><a-text value="N" align="center" position="0 0 0.1"></a-text></a-plane>
        <a-plane letra="I" position="-0.2 1.5 -3" width="0.3" height="0.3" color="#ccc"><a-text value="I" align="center" position="0 0 0.1"></a-text></a-plane>
        <a-plane letra="H" position="0.2 1.5 -3" width="0.3" height="0.3" color="#ccc"><a-text value="H" align="center" position="0 0 0.1"></a-text></a-plane>
        <a-plane letra="O" position="0.6 1.5 -3" width="0.3" height="0.3" color="#ccc"><a-text value="O" align="center" position="0 0 0.1"></a-text></a-plane>

        <!-- Botões especiais -->
        <a-plane id="apagar" position="-0.4 1.0 -3" width="0.5" height="0.3" color="#f55"><a-text value="Apagar" align="center" position="0 0 0.1" color="#000"></a-text></a-plane>
        <a-plane id="entrar" position="0.4 1.0 -3" width="0.5" height="0.3" color="#5f5"><a-text value="Entrar" align="center" position="0 0 0.1" color="#000"></a-text></a-plane>
      </a-entity>

      <!-- Imagens -->
      <a-assets>
        <img id="estrelaContenteImg" src="estrela-contente.png">
        <img id="estrelaTristeImg" src="estrela-triste.png">
      </a-assets>
    </a-scene>
  </body>
</html>
