<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Sala com Gaze e Movimento Contínuo</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
  </style>
  <script>
    AFRAME.registerComponent('gaze-move', {
      schema: {
        speed: { type: 'number', default: 1.5 },
        direction: { type: 'string', default: 'forward' }
      },
      init: function () {
        this.directionVec = new THREE.Vector3();
        this.moving = false;
      },
      play: function () {
        this.moving = true;
      },
      pause: function () {
        this.moving = false;
      },
      tick: function (time, deltaTime) {
        if (!this.moving) return;
        const camera = this.el.sceneEl.camera;
        const rig = this.el;
        const d = this.data.speed * (deltaTime / 1000);

        camera.getWorldDirection(this.directionVec);
        this.directionVec.y = 0;
        this.directionVec.normalize();

        if (this.data.direction === 'backward') {
          this.directionVec.multiplyScalar(-1);
        }

        rig.object3D.position.add(this.directionVec.multiplyScalar(d));
      }
    });
  </script>
</head>

<body>
  <a-scene>
    <!-- Chão -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="100" height="100" color="#7BC8A4"></a-plane>

    <!-- Rig com câmera e cursor -->
    <a-entity id="rig" position="0 1.6 0">
      <a-camera look-controls>
        <a-cursor 
          fuse="true" 
          fuse-timeout="2000" 
          color="red"
          geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
          material="color: red; shader: flat"
          position="0 0 -1">
        </a-cursor>
      </a-camera>
    </a-entity>

    <!-- Botão para frente -->
    <a-plane position="0 2 -3" width="1.5" height="0.5" color="#4CAF50" look-at="#rig"
             text="value: Ir para frente; align: center; color: white" 
             event-set__enter="_event: mouseenter; scale: 1.1 1.1 1"
             event-set__leave="_event: mouseleave; scale: 1 1 1"
             class="clickable"
             gaze-move="direction: forward">
    </a-plane>

    <!-- Botão para trás -->
    <a-plane position="0 1.2 -3" width="1.5" height="0.5" color="#F44336" look-at="#rig"
             text="value: Ir para trás; align: center; color: white" 
             event-set__enter="_event: mouseenter; scale: 1.1 1.1 1"
             event-set__leave="_event: mouseleave; scale: 1 1 1"
             class="clickable"
             gaze-move="direction: backward">
    </a-plane>

    <!-- Luzes -->
    <a-entity light="type: ambient; color: #ccc"></a-entity>
    <a-entity light="type: directional; color: #fff; intensity: 0.7" position="0 10 5"></a-entity>
  </a-scene>
</body>
</html>
