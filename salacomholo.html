<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Sala 360A</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>

<body>
<a-scene>

<a-assets>
  <a-asset-item id="modeloCadeira" src="cadeira_final.glb"></a-asset-item>
  <a-asset-item id="modeloRobo" src="3d+robot+model.glb"></a-asset-item>

  <img id="img-ninho" src="palavraninho.png" />
  <img id="img-estrela" src="estrelacontente.png" />
  <img id="img-estrela-triste" src="estrelatriste.png" />
  <img id="velha" src="jvelha.jpg" />
  <img id="jogo" src="brinquedo educativo2.png" />
  <img id="img-climbing" src="parededeescalada1.png" />
  <img id="img-maoesquerda" src="maoesquerda.png" />
  <img id="img-maodireita" src="maodireita.png" />
</a-assets>

<a-light type="ambient" intensity="1.2"></a-light>

<!-- Piso e paredes -->
<a-plane src="piso1.png" width="10" height="10" rotation="-90 0 0"></a-plane>
<a-plane width="10" height="5" position="0 2.5 -5" material="src: paredeerodape2.png"></a-plane>
<a-plane width="10" height="5" position="-5 2.5 0" rotation="0 90 0" material="src: paredeerodape2.png"></a-plane>

<!-- Lousa -->
<a-image id="lousa" src="lousaembranco2.png"
  width="5.6" height="3.1" position="0 2.5 -4.95">
</a-image>

<a-image id="imagem-ninho" src="#img-ninho"
  width="1" height="0.5" position="0 3 -4.9" visible="false"></a-image>

<a-text id="texto-digitado" value=""
  position="0 2.5 -4.9" visible="false"></a-text>

<a-entity id="teclado" visible="false"></a-entity>

<!-- ðŸ¤– ROBÃ” ROLO -->
<a-entity id="robo"
  gltf-model="#modeloRobo"
  position="-4.2 1.4 -4.2"
  rotation="0 310 0"
  scale="2.5 2.5 2.5"
  animation="property: position; dir: alternate; dur: 3000; easing: easeInOutSine; loop: true; to: -4.2 2 -4.2">
</a-entity>

<!-- Pegadas -->
<a-image id="pegadas1" src="pegadas.png" width="0.8" height="0.8"
  rotation="-90 0 0" position="0 0.01 -2"></a-image>

<!-- CÃ¢mera -->
<a-entity id="cameraRig" position="0 0.5 4">
  <a-camera>
    <a-cursor fuse="true" fuse-timeout="2000"
      geometry="primitive:ring;radiusInner:0.01;radiusOuter:0.02">
    </a-cursor>
  </a-camera>
</a-entity>

</a-scene>

<script>
/* ===================== ROBÃ” INTERATIVO ===================== */

let etapa = 0;
let nomeUsuario = "";
let podeMostrarLousa = false;

const robo = document.querySelector('#robo');
const lousa = document.querySelector('#lousa');
const imagem = document.querySelector('#imagem-ninho');
const teclado = document.querySelector('#teclado');
const texto = document.querySelector('#texto-digitado');

function falar(txt, cb){
  const u = new SpeechSynthesisUtterance(txt);
  u.lang = 'pt-BR';
  u.pitch = 1.6;
  u.rate = 1.1;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
  u.onend = () => cb && cb();
}

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const rec = new SpeechRecognition();
rec.lang = 'pt-BR';

rec.onresult = e => {
  const fala = e.results[0][0].transcript.toLowerCase();

  if(etapa === 1){
    nomeUsuario = fala.split(' ').pop();
    falar(`Prazer ${nomeUsuario}. Agora olhe para a lousa.`, () => {
      podeMostrarLousa = true;
      etapa = 2;
    });
  }
};

robo.addEventListener('mouseenter', () => {
  if(etapa === 0){
    falar("OlÃ¡, eu sou Rolo e vocÃª?", () => {
      etapa = 1;
      rec.start();
    });
  }
});

/* ========== LÃ“GICA DA LOUSA LIBERADA PELO ROBÃ” ========== */
lousa.addEventListener('mouseenter', () => {
  if(!podeMostrarLousa) return;

  imagem.setAttribute('visible', true);
  texto.setAttribute('visible', true);
  teclado.setAttribute('visible', true);
});
</script>

</body>
</html>
