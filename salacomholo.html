<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<title>Sala 360A</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>

<body>
<a-scene>

<!-- ASSETS -->
<a-assets>
  <a-asset-item id="modeloCadeira" src="cadeira_final.glb"></a-asset-item>
  <a-asset-item id="modeloRobo" src="3d+robot+model.glb"></a-asset-item>

  <img id="img-ninho" src="palavraninho.png" />
  <img id="img-estrela" src="estrelacontente.png" />
  <img id="img-estrela-triste" src="estrelatriste.png" />
  <img id="img-maodireita" src="maodireita.png" />
</a-assets>

<a-light type="ambient" intensity="1.2"></a-light>

<!-- PISO E PAREDES -->
<a-plane src="piso1.png" width="10" height="10" rotation="-90 0 0"></a-plane>
<a-plane width="10" height="5" position="0 2.5 -5" material="src: paredeerodape2.png"></a-plane>
<a-plane width="10" height="5" position="-5 2.5 0" rotation="0 90 0" material="src: paredeerodape2.png"></a-plane>

<!-- LOUSA -->
<a-image id="lousa" interacao-lousa src="lousaembranco2.png"
 width="5.6" height="3.1" position="0 2.5 -4.95"></a-image>

<a-image id="imagem-ninho" src="#img-ninho"
 width="1" height="0.5" position="0 3 -4.9" visible="false"></a-image>

<a-text id="texto-digitado" position="0 2.5 -4.9"
 align="center" color="#000" width="3" visible="false"></a-text>

<a-entity id="teclado" visible="false"></a-entity>

<!-- PEGADAS -->
<a-image id="pegadas1" src="pegadas.png"
 width="0.8" height="0.8" rotation="-90 0 0"
 position="0 0.01 -2" teletransporte></a-image>

<!-- MÃO DIREITA -->
<a-image id="maodireita" src="#img-maodireita"
 width="0.3" height="0.4"
 position="4.95 2.4 0.4" rotation="0 -90 0"></a-image>

<!-- ROBÔ -->
<a-entity id="robo"
 gltf-model="#modeloRobo"
 position="-4.2 1.6 -4.2"
 rotation="0 310 0"
 scale="2.5 2.5 2.5"
 animation="property: position;
           dir: alternate;
           dur: 3000;
           easing: easeInOutSine;
           loop: true;
           to: -4.2 2.0 -4.2">
</a-entity>

<!-- CÂMERA -->
<a-entity id="cameraRig" position="0 0.5 4">
<a-camera>
<a-cursor fuse="true" fuse-timeout="2000"
 geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
 material="color:red"></a-cursor>
</a-camera>
</a-entity>

</a-scene>

<script>
/* ================= ROBÔ ROLO ================= */

let etapa = 0;
let nomeUsuario = "";

function falar(t){
  const u = new SpeechSynthesisUtterance(t);
  u.lang = "pt-BR";
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
const rec = new SR();
rec.lang = "pt-BR";

rec.onresult = e => {
  const fala = e.results[0][0].transcript.toLowerCase();

  if(etapa===0){
    nomeUsuario = fala.split(" ").pop();
    nomeUsuario = nomeUsuario.charAt(0).toUpperCase()+nomeUsuario.slice(1);

    falar(`${nomeUsuario}, que palavra está escrita na lousa?`);
    etapa = 1;
    setTimeout(()=>rec.start(),4000);
  }
  else if(etapa===1){
    falar("Você poderia digitá-la no teclado virtual e depois olhar fixamente para o botão Entrar para a gente ver se você acertou?");
    etapa = 2;
  }
};

document.querySelector('#robo').addEventListener('mouseenter',()=>{
  if(etapa===0){
    falar("Olá, eu sou Rolo e você?");
    setTimeout(()=>rec.start(),2500);
  }
});

/* ===== LOUSA ===== */
AFRAME.registerComponent('interacao-lousa',{
 init(){
  this.el.addEventListener('mouseenter',()=>{
    document.querySelector('#imagem-ninho').setAttribute('visible',true);
    document.querySelector('#texto-digitado').setAttribute('visible',true);
    document.querySelector('#teclado').setAttribute('visible',true);
  });
 }
});
</script>

</body>
</html>
