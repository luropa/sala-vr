
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Sala 360A</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body>
  <a-scene>
    <a-assets>
      <a-asset-item id="modeloCadeira" src="cadeira_final.glb"></a-asset-item>

      <!-- ROB√î (ADICIONADO ‚Äì √öNICA ALTERA√á√ÉO) -->
      <a-asset-item id="modeloRobo" src="3d+robot+model.glb"></a-asset-item>

      <img id="img-ninho" src="palavraninho.png" />
      <img id="img-estrela" src="estrelacontente.png" />
      <img id="img-estrela-triste" src="estrelatriste.png" />
      <img id="velha" src="jvelha.jpg" /> 
      <img id="jogo" src="brinquedo educativo2.png" />
      <img id="img-climbing" src="parededeescalada1.png" />
      <img id="img-maoesquerda" src="maoesquerda.png" /> 
      <img id="img-maodireita" src="maodireita.png" /> 
    </a-assets>

    <a-light type="ambient" color="#ffffff" intensity="1.2"></a-light>

    <!-- Piso e paredes -->
    <a-plane src="piso1.png" width="10" height="10" rotation="-90 0 0" class="piso" material="shader: flat;"></a-plane>
    <a-plane color="#a9c9dd" width="10" height="10" position="0 5 0" rotation="90 0 0"></a-plane>
    <a-plane width="10" height="5" position="0 2.5 -5" rotation="0 0 0" material="src: paredeerodape2.png; side: front;"></a-plane>
    <a-plane width="10" height="5" position="0 2.5 5" rotation="0 180 0" material="src: paredeerodape2.png; side: front;"></a-plane>
    <a-plane width="10" height="5" position="-5 2.5 0" rotation="0 90 0" material="src: paredeerodape2.png; side: front;"></a-plane>
    <a-plane width="10" height="5" position="5 2.5 0" rotation="0 -90 0" material="src: paredeerodape2.png; side: front;"></a-plane>

    <a-image src="porta.png" width="2" height="4" position="0 2 4.99" rotation="0 180 0"></a-image>
    <a-image src="sol.png" width="2" height="2" position="0 4.95 0" rotation="-90 0 180"></a-image>

    <!-- Lousa e cord√£o alfabeto -->
    <a-image id="lousa" interacao-lousa src="lousaembranco2.png" width="5.6" height="3.1" position="0 2.5 -4.95"></a-image>
    <a-image id="cordao" src="cordao-alfabeto2.png" width="5.6" height="1.1" position="0 4.2 -4.94"></a-image>

    <a-image id="imagem-ninho" src="#img-ninho" width="1" height="0.5" position="0 3 -4.9" visible="false"></a-image>
    <a-text id="texto-digitado" value="" position="0 2.5 -4.9" color="#000" align="center" width="3" visible="false"></a-text>
    <a-entity id="teclado" visible="false"></a-entity>

    <!-- Tapetes e pegadas -->
    <a-image src="tapete.png" width="5" height="7" rotation="-90 0 0" position="-3 0.01 0.9"></a-image>
    <a-image src="ponteirotwister.png" width="0.9" height="0.9" rotation="-90 0 0" position="-1.2 0.02 1.9"></a-image>
    <a-image src="tatame2.png" width="8" height="4" rotation="90 0 90" position="3 0.01 -0.03"></a-image>
    <a-image src="quebra-cabeca.png" width="1.4" height="1.8" rotation="-90 10 0" position="1.55 0.02 2"></a-image>
    <a-image src="janela2.png" width="5.5" height="5.5" position="-4.95 2.5 0" rotation="0 90 0"></a-image>

    <!-- Jogo da velha e brinquedo educativo -->
    <a-image id="jogoVelha" src="#velha" width="1.5" height="1.5" position="-4.95 1.8 3.5" rotation="0 90 0"></a-image>
    <a-image id="brinquedoEducativo" src="#jogo" width="1.5" height="1.5" position="-2.8 1.8 4.95" rotation="0 180 0"></a-image>

    <a-image src="interruptor-branco.png" width="0.3" height="0.3" position="-1.5 2 4.94" rotation="0 180 0"></a-image>
    <a-image src="relogio2.png" width="0.8" height="0.8" position="3.5 2.5 -4.95"></a-image>
    <a-image src="nuvem2.png" width="2" height="1.7" position="3.5 3.5 -4.95"></a-image>
    <a-image src="nuvem2.png" width="2" height="1.7" position="-3.5 3.5 -4.95"></a-image>
    <a-image src="nuvem2.png" width="2" height="1.7" position="3 4.5 -4.93"></a-image>
    <a-image src="nuvem2.png" width="2" height="1.7" position="-3 4.5 -4.93"></a-image>

    <a-entity id="cadeira" gltf-model="#modeloCadeira" position="3 0 -3" scale="0.8 0.8 0.8" teletransporte></a-entity>

    <!-- ROB√î (ADICIONADO ‚Äì √öNICA ALTERA√á√ÉO) -->
    <a-entity
  id="robo"
  class="interativo"
  gltf-model="#modeloRobo"
  position="-4.2 1.4 -4.2"
  rotation="0 310 0"
  scale="2.5 2.5 2.5"
  visible="false"
  /animation="property: position;
             dir: alternate;
             dur: 3000;
             easing: easeInOutSine;
             loop: true;
             to: -4.2 2.0 -4.2">>/
</a-entity>



    

    <!-- Pegadas com teletransporte suave -->
    <a-image id="pegadas1" src="pegadas.png" width="0.8" height="0.8" rotation="-90 0 0" position="0 0.01 -2" teletransporte></a-image>
    <a-image id="pegadas2" src="pegadas.png" width="0.8" height="0.8" rotation="-90 -90 0" position="3 0.02 0" teletransporte></a-image>
    <a-image id="pegadas4" src="pegadas.png" width="0.8" height="0.8" rotation="-90 130 5" position="-3.8 0.05 3.8" teletransporte></a-image>

    <!-- Parede de escalada -->
    <a-image id="climbingWall" src="#img-climbing" width="8" height="5" position="4.97 2.5 0" rotation="0 -90 0"></a-image>
    <a-image id="maoesquerda" src="#img-maoesquerda" width="0.3" height="0.4" position="4.95 3 -0.2" rotation="0 -90 0"></a-image>
    <a-image id="maodireita" src="#img-maodireita" width="0.3" height="0.4" position="4.95 2.45 0.44" rotation="0 -90 0"></a-image>

    <!-- C√¢mera -->
    <a-entity id="cameraRig" position="0 0.5 4">
  <a-camera look-controls wasd-controls-enabled="true">
    <a-cursor
      id="cursor"
      fuse="true"
      fuse-timeout="1500"
      color="red">
    </a-cursor>
  </a-camera>
</a-entity>

  </a-scene>
  const robo = document.querySelector('#robo');
let roboApareceu = false;

function aparecerRoboComEfeitoTV() {
  if (roboApareceu) return;
  roboApareceu = true;

  robo.setAttribute('visible', true);

  // come√ßa pequeno e "bugado"
  robo.setAttribute('scale', '0.1 2.8 0.1');
  robo.setAttribute('material', 'opacity: 0.2');

  // glitch vertical
  robo.setAttribute('animation__glitch', {
    property: 'scale',
    dur: 120,
    loop: 6,
    dir: 'alternate',
    to: '2.5 2.2 2.5'
  });

  // fade in
  robo.setAttribute('animation__fade', {
    property: 'material.opacity',
    dur: 800,
    easing: 'easeOutQuad',
    to: 1
  });

  // estabiliza tamanho
  robo.setAttribute('animation__scale', {
    property: 'scale',
    dur: 800,
    easing: 'easeOutElastic',
    to: '2.5 2.5 2.5'
  });
}

<script>
    // --- Teletransporte suave e pegadas ---
    let emAnimacao = false;
    const cameraRig = document.querySelector('#cameraRig');
    const maodireita = document.querySelector('#maodireita');
    const pegadasParede = document.querySelector('#pegadas2');
    const pegadasLousa = document.querySelector('#pegadas1'); // pegada para a lousa
    const outrasPegadas = document.querySelectorAll('[teletransporte]:not(#maodireita):not(#pegadas2):not(#pegadas1)');
    const todasPegadas = document.querySelectorAll('[teletransporte]');

    function teletransportarPara(pos, manterDistancia=false, manterAltura=false, afastar=0.5, callback=null) {
      if(emAnimacao) return;
      emAnimacao = true;

      const startPos = cameraRig.object3D.position.clone();
      const targetPos = pos.clone();

      if(manterDistancia) {
        const pegPos = pegadasParede.object3D.position;
        const distanciaParede = Math.abs(pegPos.x - 4.97);
        targetPos.x = pos.x - distanciaParede;
        targetPos.z = pos.z;
      }

      if(manterAltura) targetPos.y = pos.y;

      const duration = 2000;
      const startTime = performance.now();

      function animate(time) {
        const t = Math.min((time - startTime) / duration, 1);
        cameraRig.object3D.position.lerpVectors(startPos, targetPos, t);
        if(t < 1) {
          requestAnimationFrame(animate);
        } else {
          emAnimacao = false;
          if(callback) callback();
        }
      }

      requestAnimationFrame(animate);
    }

    // --- Fuse para m√£o direita ---
    maodireita.addEventListener('mouseenter', () => {
      if(emAnimacao) return;
      maodireita.timeout = setTimeout(() => {
        const camPos = cameraRig.object3D.position;
        const pegPos = pegadasParede.object3D.position;
        if(camPos.distanceTo(pegPos) < 0.5) {
          outrasPegadas.forEach(p => p.dataset.inativo = 'true');
          teletransportarPara(maodireita.object3D.position, true, true, 1.0, () => {
            outrasPegadas.forEach(p => p.dataset.inativo = 'true');
            pegadasParede.dataset.inativo = 'false';
          });
        }
      }, 2000);
    });
    maodireita.addEventListener('mouseleave', () => clearTimeout(maodireita.timeout));

    // --- Teletransporte normal das pegadas ---
    todasPegadas.forEach(peg => {
      peg.addEventListener('click', () => {
        if(emAnimacao) return;
        if(peg.dataset.inativo === 'true') return;

        // Desativa teletransporte para a pegada da lousa se a c√¢mera estiver na altura da m√£o
        if(peg.id === 'pegadas1' && cameraRig.object3D.position.y >= 2) return;

        teletransportarPara(peg.object3D.position, false, false, 0.5, () => {
  if (peg.id === 'pegadas1') {
    aparecerRoboComEfeitoTV();
  }
});

      });
    });

    // --- Reativar todos os teletransportes sobre pegadas da parede ---
    pegadasParede.addEventListener('click', () => {
      todasPegadas.forEach(p => p.dataset.inativo = 'false');
    });

    // --- Lousa e teclado condicionado ---
    const lousa = document.querySelector('#lousa');
    const imagem = document.querySelector('#imagem-ninho');
    const teclado = document.querySelector('#teclado');
    const textoDigitado = document.querySelector('#texto-digitado');
    const tamanhoOriginal = { width: 1, height: 0.5 };
    let tecladoCriado = false;
    let finalizou = false;

    AFRAME.registerComponent('interacao-lousa', {
      init: function () {
        this.el.addEventListener('mouseenter', () => {
          if(finalizou) return;
          const camPos = cameraRig.object3D.position;
          const pegPos = pegadasLousa.object3D.position; 
          if(camPos.distanceTo(pegPos) < 0.5) { 
            this.timeout = setTimeout(() => {
              imagem.setAttribute('visible', true);
              textoDigitado.setAttribute('visible', true);
              textoDigitado.setAttribute('value', '');
              imagem.setAttribute('src', '#img-ninho');
              imagem.setAttribute('width', tamanhoOriginal.width.toString());
              imagem.setAttribute('height', tamanhoOriginal.height.toString());
              imagem.setAttribute('position', '0 3 -4.9');

              if (!tecladoCriado) {
                criarTeclado();
                tecladoCriado = true;
              }

              teclado.setAttribute('visible', true);
            }, 2000);
          }
        });
        this.el.addEventListener('mouseleave', () => clearTimeout(this.timeout));
      }
    });

    function criarTeclado() {
      const letras = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
      const espacamentoX = 0.3;
      const espacamentoY = 0.3;
      const startX = -6 * espacamentoX;
      const startY = 1.9;
      const corTecla = '#ffffff';
      const opacidadeTecla = 0;

      letras.forEach((letra, index) => {
        const linha = index < 13 ? 0 : 1;
        const col = index % 13;
        const x = startX + col * espacamentoX;
        const y = startY - linha * espacamentoY;

        const plano = document.createElement('a-plane');
        plano.setAttribute('width', 0.35);
        plano.setAttribute('height', 0.35);
        plano.setAttribute('color', corTecla);
        plano.setAttribute('opacity', opacidadeTecla);
        plano.setAttribute('position', `${x} ${y} -4.9`);

        const letraText = document.createElement('a-text');
        letraText.setAttribute('value', letra);
        letraText.setAttribute('color', '#000');
        letraText.setAttribute('align', 'center');
        letraText.setAttribute('width', '2');
        letraText.setAttribute('position', '0 0 0.02');

        plano.appendChild(letraText);

        plano.addEventListener('click', () => {
          // Teclado s√≥ funciona se a c√¢mera estiver sobre pegadas1
          const camPos = cameraRig.object3D.position;
          const pegPos = pegadasLousa.object3D.position;
          if(finalizou || camPos.distanceTo(pegPos) > 0.5) return;

          let textoAtual = textoDigitado.getAttribute('value');
          if (!textoAtual.endsWith(letra)) {
            textoDigitado.setAttribute('value', textoAtual + letra);
          }
        });

        teclado.appendChild(plano);
      });

      criarBotaoExtra('Apagar', -1, startY - 2 * espacamentoY, () => {
        const camPos = cameraRig.object3D.position;
        const pegPos = pegadasLousa.object3D.position;
        if(finalizou || camPos.distanceTo(pegPos) > 0.5) return;

        let textoAtual = textoDigitado.getAttribute('value');
        textoDigitado.setAttribute('value', textoAtual.slice(0, -1));
      }, corTecla, opacidadeTecla);

      criarBotaoExtra('Entrar', 1, startY - 2 * espacamentoY, () => {
        const camPos = cameraRig.object3D.position;
        const pegPos = pegadasLousa.object3D.position;
        if(finalizou || camPos.distanceTo(pegPos) > 0.5) return;

        const texto = textoDigitado.getAttribute('value').trim().toUpperCase();
        if (texto === 'NINHO') {
          imagem.setAttribute('src', '#img-estrela');
          imagem.setAttribute('width', '1.7');
          imagem.setAttribute('height', '1.5');
          imagem.setAttribute('position', '0 2.8 -4.8');
          textoDigitado.setAttribute('visible', false);
          teclado.setAttribute('visible', false);
          finalizou = true;
        } else {
          imagem.setAttribute('src', '#img-estrela-triste');
          imagem.setAttribute('material', 'transparent: true');
          imagem.setAttribute('width', '1.7');
          imagem.setAttribute('height', '1.5');
          imagem.setAttribute('position', '0 2.8 -4.8');
          textoDigitado.setAttribute('visible', false);
          setTimeout(() => {
            imagem.setAttribute('src', '#img-ninho');
            imagem.setAttribute('width', tamanhoOriginal.width.toString());
            imagem.setAttribute('height', tamanhoOriginal.height.toString());
            imagem.setAttribute('position', '0 3 -4.9');
            textoDigitado.setAttribute('value', '');
            textoDigitado.setAttribute('visible', true);
            teclado.setAttribute('visible', true);
          }, 3000);
        }
      }, corTecla, opacidadeTecla);
    }

    function criarBotaoExtra(texto, x, y, callback, cor, opacidade) {
      const plano = document.createElement('a-plane');
      plano.setAttribute('width', 1);
      plano.setAttribute('height', 0.3);
      plano.setAttribute('color', cor);
      plano.setAttribute('opacity', opacidade);
      plano.setAttribute('position', `${x} ${y} -4.9`);

      const textoEntity = document.createElement('a-text');
      textoEntity.setAttribute('value', texto);
      textoEntity.setAttribute('align', 'center');
      textoEntity.setAttribute('color', '#000');
      textoEntity.setAttribute('width', '2');
      textoEntity.setAttribute('position', '0 0 0.02');

      plano.appendChild(textoEntity);
      plano.addEventListener('click', callback);
      teclado.appendChild(plano);
    }
  </script>
  <script>
  const robo = document.querySelector('#robo');

  const reconhecimento = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  reconhecimento.lang = 'pt-BR';
  reconhecimento.interimResults = false;
  reconhecimento.maxAlternatives = 1;

  let nomeUsuario = '';
  let etapa = 0;

  function falar(texto, callback) {
    const fala = new SpeechSynthesisUtterance(texto);
    fala.lang = 'pt-BR';
    fala.onend = () => {
      if (callback) callback();
    };
    speechSynthesis.speak(fala);
  }

  robo.addEventListener('mouseenter', () => {
    if (etapa !== 0) return;

    etapa = 1;
    falar('Ol√°, eu sou Rolo. Qual √© o seu nome?', () => {
      reconhecimento.start();
    });
  });

  reconhecimento.onresult = (event) => {
    const resposta = event.results[0][0].transcript.trim();
    
    if (etapa === 1) {
      nomeUsuario = resposta;
      etapa = 2;

      falar(`Prazer, ${nomeUsuario}! Agora me diga: que palavra est√° escrita na lousa?`, () => {
        reconhecimento.start();
      });

    } else if (etapa === 2) {
      etapa = 3;

      falar(
        'Voc√™ poderia digit√°-la no teclado virtual e depois olhar fixamente para o bot√£o Entrar para a gente ver se voc√™ acertou?'
      );
    }
  };

  reconhecimento.onerror = () => {
    falar('N√£o consegui te ouvir. Pode tentar novamente?');
    etapa = 0;
  };

  function roboAcertou() {
    falar('Muito bem! Voc√™ acertou!');
    robo.setAttribute('animation__empolgado', {
      property: 'rotation',
      to: '0 360 0',
      dur: 1000
    });
  }

  function roboErrou() {
    falar('N√£o desanime, tente outra vez!');
  }


  const robo = document.querySelector('#robo');
let roboApareceu = false;

function aparecerRoboComEfeitoTV() {
  if (roboApareceu) return;
  roboApareceu = true;

  console.log("ü§ñ Rob√¥ aparecendo!");

  robo.setAttribute('visible', true);

  // come√ßa "desregulado"
  robo.setAttribute('scale', '0.05 3 0.05');

  // efeito de sintonia (glitch vertical)
  robo.setAttribute('animation__sintonia', {
    property: 'scale',
    dur: 120,
    dir: 'alternate',
    loop: 8,
    to: '2.5 2.0 2.5'
  });

  // estabiliza
  setTimeout(() => {
    robo.removeAttribute('animation__sintonia');

    robo.setAttribute('animation__normaliza', {
      property: 'scale',
      dur: 600,
      easing: 'easeOutElastic',
      to: '2.5 2.5 2.5'
    });

    // flutua√ß√£o suave FINAL
    robo.setAttribute('animation__flutuar', {
      property: 'position',
      dir: 'alternate',
      dur: 3000,
      easing: 'easeInOutSine',
      loop: true,
      to: '-4.2 2.0 -4.2'
    });

  }, 1000);
}
  
</script>

</body>
</html>
